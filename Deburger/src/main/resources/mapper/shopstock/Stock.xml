<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.deburger.app.shop.stock.mapper.StockMapper">
	<select id="selectStock" parameterType="StockVO">
        		select m.material_number
		,m.material_name
		,m.material_classification
		,m.unit
		,m.sale_unitprice
		,NVL(s.stock_count,0) AS stock_Count
		,NVL(s.safety_stock,0) AS safety_Stock
		from (select * from store_stock where store_number = #{storeNumber} ) s 
		RIGHT OUTER JOIN material m  on	s.material_number =	m.material_number
		order by STOCK_COUNT DESC
	</select>

	<insert id="insertCart" parameterType="StockVO">
		INSERT INTO
		order_cart(cart_number
		,store_number
		,material_number
		,count)
		VALUES
		(OC_SEQ.NEXTVAL
		,#{storeNumber}
		,#{materialNumber}
		,1)
	</insert>

	<select id="selectStockinfo" parameterType="StockVO">
		select
		i.expiration_limit
		,m.material_name
		,i.remain_stock_count
		,d.count
		,o.order_day
		,i.order_details_number
		,i.Material_number
		from store_in i
		join material m
		on i.Material_number = m.Material_number
		join
		order_details d
		on i.order_details_Number = d.order_details_Number
		join
		store_Order o
		on o.order_number = d.order_number
		where i.Material_number	= #{materialNumber}
		and i.store_number = #{storeNumber}
		order by i.order_details_number
	</select>

	<update id="updqtestoreStock" parameterType="StockVO">
		update store_stock
		set stock_count = stock_count + #{stockCount}
		where store_Number = #{storeNumber}
		AND MATERIAL_NUMBER = #{materialNumber} 
	</update>

	<update id="updqtestoreIn" parameterType="StockVO">
		update store_in
		set remain_Stock_Count = remain_Stock_Count + #{remainStockCount}
		where order_details_number = #{orderDetailsNumber}
	</update>

	<insert id="insertstoreProductSale" parameterType="StockVO">
		Insert Into store_Material_consumption(
			material_Number
			,amountcon
			,product_date
			,seq
			,store_number
			,operation
			,note
		)
		values(
			#{materialNumber}
			,#{amountcon}
			,sysdate
			,SM_SEQ.NEXTVAL
			,#{storeNumber}
			,'M1'
			,#{note}
		)
	</insert>

</mapper>