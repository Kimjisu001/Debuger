<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.deburger.app.office.logistic.mapper.LogisticMapper">
	
<!-- 물류창고 전체 조회 -->
	<select id="selectLogisticAll" resultType="LogisticVO">
		SELECT logistics_id
		      , logistics_name
		      , basics_address || ' ' || details_address || ' ' || note as address
		      , permission_day
		FROM logistics
		ORDER BY logistics_id
	</select>


<!-- 물류창고 상세 조회 -->
	<select id="selectLogisticInfo" resultType="LogisticVO">
		SELECT DISTINCT l.logistics_id
		      , l.logistics_name
		      , s.material_number
		      , m.material_name
		      , m.unit
		      , s.stock_count
		      , i.expiration_limit
		      , (m.logistics_safety_stock - s.stock_count) AS require_stock
		      , (SELECT SUM(stock_count)
		         FROM logistics_stock) AS all_stock
		FROM logistics l JOIN logistics_stock s
		                 ON (l.logistics_id = s.logistics_id)
		                JOIN material m 
		                ON (m.material_number = s.material_number)
		                LEFT OUTER JOIN logistics_in i
		                ON (i.material_number = m.material_number)
		WHERE l.logistics_id = #{logisticsId}
		
	</select>
	

<!-- 물류창고 물품 상세 조회 -->
	<select id="selectLogisticMaterialInfo" resultType="LogisticVO">
		SELECT i.material_number 
		      , m.material_name
		      , m.material_classification
		      , i.expiration_limit
		      , i.in_day
		FROM logistics_in i JOIN material m 
		                    ON i.material_number = m.material_number
		                    JOIN logistics_order_details d
		                    ON d.details_order_number = i.details_order_number
		                    JOIN logistics_order l
		                    ON l.order_number = d.order_number
		WHERE i.material_number=#{materialNumber}
	</select>
	
	
	
	
</mapper>