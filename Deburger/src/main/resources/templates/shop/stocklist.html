<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/shop_layout}"
	layout:fragment="Content">


<head>
<meta charset="UTF-8" />
<title>재고 관리</title>
</head>

<body>
	<main id="main" class="main">
		<div class="pagetitle">
			<h1>재고 관리</h1>
			<button type="button" class="btn btn-primary btn-sm"
								style="padding: 5px 20px 5px 20px; margin-left: 80%;"
								onClick="location.href='selectOrderCart'">발주 신청</button>
		</div>
		<!-- End Page Title -->
		<section class="section">
			<div class="row">
				<div class="col-lg-12">
					<div class="card">
						<div class="card-body">
							<!-- Table with stripped rows -->
							<!-- <table class="table datatable"> -->
							
							<form>
								<table class="table">
									<thead>
										<tr>
											<th>품목 코드</th>
											<th>품목 이름</th>
											<th>
											<select id="stockC">
												<option value="main">품목 구분</option>
												<option th:each="stockCList : ${stockC}" th:value="${stockCList.materialClassification}" th:text="${stockCList.materialClassification}"></option>
											</select>
											</th>
											<th>규격</th>
											<th>단가</th>
											<th>현재 재고</th>
											<th>적정 재고</th>
											<th>발주</th>
										</tr>
									</thead>
									<tbody>
										<th:block th:each="list:${stockList}">
											<tr>
												<td th:text="${list.materialNumber}" id="number"/>
												<td th:text="${list.materialName}" />
												<td th:text="${list.materialClassification}" />
												<td th:text="${list.unit}" />
												<td th:text="${list.saleUnitprice}" />
												<td th:text="${list.stockCount}" />
												<td th:text="${list.safetyStock}" />
												<td><button type="button"
														class="btn btn-primary btn-sm"
														th:id="${list.materialNumber}"
														onclick="event.stopPropagation()">발주하기</button></td>

											</tr>
										</th:block>
									</tbody>

								</table>
							</form>
							<!-- End Table with stripped rows -->
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>
	<script>
		$("td > button").on("click", function(event) {
			alert("발주 목록에 저장되었습니다.");
			let url = 'shopCartInsert?materialNumber=' + event.target.id;
			location.href = url;
		});

		$('tbody > tr').on("click", function(event) {
			let num = $(event.currentTarget).children().eq(0).text();
			let url = 'shopStockInfo?materialNumber=' + num;
			location.href = url;
		});
		
		$("#stockC").on("change", function(event) {		
			let materialClassification = $('#stockC').val();
			let list = {materialClassification};
			$.ajax({
				
				url : "classificationList",
				method : "Post",
				contentType:"application/JSON",
				data : JSON.stringify(list),
				
			})
			
			.then((result) => {
				console.log(result);
				console.log(result[0]);
				console.log(result[0].materialClassification);
				
				for(let i in result){
					$('#number').html()=result[i].materialClassification;
				}
			})
			
		});

	</script>
</body>
</html>
