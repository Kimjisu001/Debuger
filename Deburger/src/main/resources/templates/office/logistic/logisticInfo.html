<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/layout}"
	  layout:fragment="Content">
<head>
<meta charset="UTF-8">

<title>Insert title here</title>
</head>
<body>


  <main id="main" class="main">

    <div class="pagetitle">
      <h1>업체 상세조회</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">공급업체 관리</a></li>
          <li class="breadcrumb-item active">업체 조회</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->
    
    

    <section class="section dashboard">

    <div class="row">
    <div class="col-lg-4">
    <!-- Website Traffic -->
          <div class="card">
            <div class="filter">
              <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <li class="dropdown-header text-start">
                  <h6>Filter</h6>
                </li>
                <li><a class="dropdown-item" href="#">Today</a></li>
                <li><a class="dropdown-item" href="#">This Month</a></li>
                <li><a class="dropdown-item" href="#">This Year</a></li>
              </ul>
            </div>
            
            <div class="card-body pb-0">
              <h5 class="card-title"></h5>

              <div id="trafficChart" style="min-height: 400px;" class="echart"></div>

              <script>
                document.addEventListener("DOMContentLoaded", () => {
                  echarts.init(document.querySelector("#trafficChart")).setOption({
                    tooltip: {
                      trigger: 'item'
                    },
                    legend: {
                      top: '5%',
                      left: 'center'
                    },
                    series: [{
                      name: 'Access From',
                      type: 'pie',
                      radius: ['40%', '70%'],
                      avoidLabelOverlap: false,
                      label: {
                        show: false,
                        position: 'center'
                      },
                      emphasis: {
                        label: {
                          show: true,
                          fontSize: '18',
                          fontWeight: 'bold'
                        }
                      },
                      labelLine: {
                        show: false
                      },
                      
                      
                      data: [{
                          value: 100,
                          name: 'Search Engine'
                        },
                        {
                          value: 735,
                          name: 'Direct'
                        },
                        {
                          value: 580,
                          name: 'Email'
                        },
                        {
                          value: 484,
                          name: 'Union Ads'
                        },
                        {
                          value: 300,
                          name: 'Video Ads'
                        }
                      ] //end data
                      
                      
                    }]
                  });
                });
              </script>

            </div>
          </div><!-- End Website Traffic -->
          
          
          
          <!-- 유통기한 임박 -->
          
              <div class="card info-card sales-card">

                <div class="card-body">
                  <h5 class="card-title">유통기한 임박 <span> | 발주 필요 재고</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="ps-0">
                      <h6>145</h6>
                      <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span>
                    </div>
                  </div>
                </div>
                
                
               	<div class="card-body">
                  <h5 class="card-title">유통기한 임박 <span> | 발주 필요 재고</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="ps-0">
                      <h6>145</h6>
                      <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span>
                    </div>
                  </div>
                </div>
               
            </div><!-- End Sales Card -->



              <div class="card info-card sales-card">

                <div class="card-body">
                  <h5 class="card-title">유통기한 임박 <span> | 발주 필요 재고</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="ps-0">
                      <h6>145</h6>
                      <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span>
                    </div>
                  </div>
                </div>
               
            </div><!-- End Sales Card -->
            
          </div>

        <div class="col-lg-8">

          <div class="card">
            <div class="card-body">
              <h5 class="card-title">전체재고</h5>

              <!-- Table with hoverable rows -->
              <table class="table table-hover">
                <thead>
                  <tr>
                  	<th scope="col">NO</th>
                    <th scope="col">재료코드</th>
                    <th scope="col">재료명</th>
                    <th scope="col">수량</th>
                    <th scope="col">용량</th>
                    <th scope="col">발주필요 재고</th>
                    
                  </tr>
                </thead>
                <tbody>
	            <th:block th:each="info, stats : ${logistic}">
	            	<tr th:data-mid=${info.materialNumber} data-bs-toggle="modal" data-bs-target="#modalDialogScrollable">
	            		<td>[[ ${stats.count} ]]</td>
	            		<td>[[ ${info.materialNumber} ]]</td>
	            		<td>[[ ${info.materialName} ]]</td>
	            		<td>[[ ${info.stockCount} ]]개</td>
	            		<td>[[ ${info.unit} ]]</td>
	            		<td th:text="${info.requireStock} < 0 ? '충분' : '부족' "></td>
	                </tr>
	            </th:block>
                </tbody>
              </table>
              <!-- End Table with hoverable rows -->
              
              

              <div class="modal fade" id="modalDialogScrollable" tabindex="-1">
                <div class="modal-dialog modal-dialog-scrollable">
                  <div class="modal-content">
                  
                    <div class="modal-header">
                      <h3 class="modal-title"></h3>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                    
                    <div id="top-tag">
                    	<h5><b>분류 : </b><span id="mate_class"></span></h5>
                    	<h5><b>용량 : </b><span id="mate_unit"></span></h5>
                    	<h5><b>안전수량 : </b><span id="mate_safetyStock"></span></h5>
                    	<h5><b>거래처 : </b><span id="mate_supplier"></span></h5>
                    </div>
					
		              <!-- Small tables -->
		              <table class="table table-sm">
		                <thead>
		                  <tr>
		                    <th scope="col">입고일</th>
		                    <th scope="col">유통기한</th>
		                    <th scope="col">입고수량</th>
		                  </tr>
		                </thead>
		                <tbody class="mat_detail">
		                </tbody>
		              </table>
		              <!-- End small tables -->

                    </div>
                    
                    
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                      <!--  <button type="button" class="btn btn-primary">Save changes</button> -->
                    </div>
                  </div>
                </div>
              </div><!-- End Modal Dialog Scrollable-->

            </div>
          </div>
          
        </div>
    </div>

    </section>
	
  </main><!-- End #main -->
  
</body>




<script>

	const urlParams = new URL(location.href).searchParams;
	const lid = urlParams.get('logisticsId');
	
	$('tbody > tr').on('click', makeTag);
		
	function makeTag() {
		
		let tr = event.currentTarget;
		let mid = $(tr).data('mid');
		console.log(mid);
		//let url = "http://localhost:8094/deburger/stockInfoAjax?materialNumber" + mid;
		
		$.ajax({
			url:"stockInfoAjax?materialNumber="+mid + "&logisticsId=" + lid,
			method: "GET"
		})
		.done(data => {
			
			$('.modal-title').append(`${data[0].materialName}`);

			let tag = ` 
                    	<h5><b>분류 : </b><span id="mate_class">${data[0].materialClassification}</span></h5>
                    	<h5><b>용량 : </b><span id="mate_unit">${data[0].unit}</span></h5>
                    	<h5><b>안전수량 : </b><span id="mate_safetyStock">${data[0].logisticsSafetyStock}개</span></h5>
                    	<h5><b>거래처 : </b><span id="mate_supplier">${data[0].aggclientName}</span></h5>`
			
            $('#top-tag').html(tag); //append는 계속 갖다 붛히는거, html로 초기화

			
			data.forEach(element => {
				let tr = document.createElement('tr');
				$(tr).append(`<td>${element.inDay}</td>`);
				$(tr).append(`<td>${element.expirationLimit}</td>`);
				$(tr).append(`<td>${element.inCount}</td>`);
				$('.mat_detail').append(tr);
			});
		})
		.fail (err => console.log(err))
		
	}
	
	
	
	
	/*
	$('#modalDialogScrollable').on('hidden.bs.modal', function () {
		$(this).removeData();
	})
	*/
	
	
	//모달 초기화
	$('#modalDialogScrollable').on('hidden.bs.modal', function () {
		document.querySelector('.mat_detail').innerHTML="";
		document.querySelector('.modal-title').innerHTML="";
		document.querySelector('#top-tag').innerHTML="";
		
	});
	
	
</script>

</html>
<!-- 모달창 만들고, 모양 잡고, 모달창 위에 있는 데이터를 (document.get attr 해서 innerHTML) -->


<!--/*

	<td th:if="${info.requireStock} < 0">충분</td>
	<td th:unless="${info.requireStock} < 0">부족</td>
  <td th:if="${info.minExpirationLimit} - localDateTime > 7">유효</td>
*/-->

<!--/* 

	$.ajax("/stockInfoAjax?materialNumber="+mid, {
      method : "get",
      //contentType : "application/json",
      //data : JSON.stringify({materialNumber : mid})
    })
    .done(data => {
    
     })
     .fail(err => console.log(err))
		
	});
	
 */-->
 
 
 
<!--/*  
	            		
	<td>[[ ${#dates.format(info.minExpirationLimit, 'yyyy-MM-dd')} ]]</td>
	            		
	<td>[[ ${#dates.day(info.minExpirationLimit)} ]]</td>
	<td>[[ ${#dates.month(info.minExpirationLimit)} ]]</td>
	            		
	<td>[[ ${#temporals.month(localDateTime)} ]]</td>
	<td>[[ ${#temporals.day(localDateTime)} ]]</td>
	            		
	<td th:if="${#dates.day(info.minExpirationLimit)} < ${#temporals.day(localDateTime)}">만료</td>
	<td th:unless="${#dates.day(info.minExpirationLimit)} < ${#temporals.day(localDateTime)}">유효</td>
	            		
*/-->
	            		
	            		